<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Bookshelf</title>
    <link rel="stylesheet" href="stylesDashboard.css">
</head>
<body>
<div class="top-bar">
    <h1>My Books</h1>

    <!--Live Auto Suggestion -->
    <form action="/getMappingResults" method="get">
        <input type="text" name="name" placeholder="Search" class="searchbar" id="searchbar">
        <div id="autocomplete-list" class="autocomplete-suggestions"></div>
        <input type="submit" value="Go">
    </form>
    <!--Falls ungültiges Buch wird Fehlernachricht gesendet -->
    {{#errorMessage}}
        <div class="error">
            {{errorMessage}}
        </div>
    {{/errorMessage}}
</div>

<!--Bookshelf, alle Bücher werden angezeigt. +Namen überarbeiten -->
<div class="over">
    <div class="shelf">

        {{#books}}
            <div class="totalBookView">
                <a class="book-cover" href="chosenBook">
                    <h3> {{title}}</h3>
                    <p> {{author}}</p>

                </a>
                <p class="pageCount"> {{pageCurrent}} / {{pagesTotal}}</p>
            </div>
        {{/books}}

    </div>
</div>
<hr>

<!--Navigations Button um Seiten zu navigieren -->
<nav>
    <form method="get" action="/dashboard">
        <button class="go-dash-button" type="submit">Bookshelf</button>
    </form>
    <form method="get" action="/quotes">
        <button class="go-quotes-button" type="submit">Quotes</button>
    </form>
    <form method="get" action="/impressum">
        <button class="go-impressum-button" type="submit">Impressum</button>
    </form>
</nav>

<!--Live Auto Suggestion JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchbar");
        const autocompleteList = document.getElementById("autocomplete-list");

        searchInput.addEventListener("input", function () {
            const query = this.value;
            if (query.length < 1) {
                autocompleteList.innerHTML = "";
                return;
            }

            fetch(`/autocomplete?query=${query}`)
                    .then(response => response.json())
                    .then(data => {
                        autocompleteList.innerHTML = "";
                        data.forEach(item => {
                            const div = document.createElement("div");
                            div.classList.add("autocomplete-suggestion");
                            div.textContent = item;
                            div.addEventListener("click", function () {
                                searchInput.value = item;
                                autocompleteList.innerHTML = "";
                            });
                            autocompleteList.appendChild(div);
                        });
                    });
        });

        document.addEventListener("click", function (e) {
            if (e.target !== searchInput) {
                autocompleteList.innerHTML = "";
            }
        });
    });
</script>
</body>
</html>